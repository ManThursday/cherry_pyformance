<!DOCTYPE html>
<html>
<head>

  <title>${statement['sql'] if len(statement['sql'])>50 else statement['sql'][:47]+'...'}</title>

  <style type="text/css" title="currentStyle">
    @import "/css/jquery-ui-1.10.3.custom.min.css";
    @import "/css/sh_acid.min.css";
    @import "/css/jquery.dataTables.css";
    pre{font-size: 12pt;
        margin: 0 auto;
        width: 800px;}
    path{fill:none;
        stroke:black;
        stroke-width:2px;}
    svg{border: 1px black solid;}
  </style>

  <script type="text/javascript" src="/js/jquery.js"></script>
  <script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="/js/sh_main.min.js"></script>
  <script type="text/javascript" src="/js/sh_sql.min.js"></script>
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

  <script type="text/javascript">
    $(document).ready(function(){

      var statement = ${str(statement).replace('"','\\"').replace('\'','"')};
      var dataHtml = '';
      for (var i=0; i<4; i++){
        var key = ['avg','count','min','max'][i];
        dataHtml += '<tr><td>'+key+':</td><td>'+statement[key]+'</td></tr>';
      };
      $('#data').html(dataHtml);

      sh_highlightDocument();

      var height=400;
      var width=700;
      var margin=50;

      function draw(data){

        d3.select('body')
          .append('svg')
            .attr('width',width)
            .attr('height',height)
          .selectAll('circle')
          .data(data)
          .enter()
          .append('circle')

        var x_extent = d3.extent(data, function(d){return d.datetime});
        var x_scale = d3.scale.linear()
                              .range([margin,width-margin])
                              .domain(x_extent);
        var y_extent = d3.extent(data, function(d){return d.duration});
        var y_scale = d3.scale.linear()
                              .range([height-margin,margin])
                              .domain(y_extent);
        d3.selectAll('circle')
                    .attr('cx', function(d){return x_scale(d.datetime)})
                    .attr('cy', function(d){return y_scale(d.duration)})
                    .attr('r',3);

        var line = d3.svg.line()
                         .x(function(d){return x_scale(d.datetime)})
                         .y(function(d){return y_scale(d.duration)});
        d3.select('svg')
          .append('path')
            .attr('d',line(data));
      
      
        };
      

      draw(statement.calls);


    });
  </script>
</head>
<body>

  <a href="/">Home</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/aggregatesql">Aggregated SQL</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;Statement
  <div>
    <pre class="sh_sql">${statement['sql'].replace(',',',\n      ').replace('AND','\n  AND')}</pre>
  </div>
  <table id="data"></table>


</body>
</html>
