<!DOCTYPE html>
<html>
<head>

  <title>${statement[1] if len(statement[1])<50 else statement[1][:47]+'...'}</title>

  <style type="text/css" title="currentStyle">
    @import "/css/jquery-ui-1.10.3.custom.min.css";
    @import "/css/sh_acid.min.css";
    @import "/css/jquery.dataTables.css";
    pre{font-size: 12pt;
        margin: 0 auto;
        width: 800px;}
    path{fill:none;
        stroke:black;
        stroke-width:2px;}
    svg{border: 1px black solid;}
  </style>

  <script type="text/javascript" src="/js/jquery.js"></script>
  <script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="/js/sh_main.min.js"></script>
  <script type="text/javascript" src="/js/sh_sql.min.js"></script>
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

  <script type="text/javascript">
    $(document).ready(function(){


      var height=400;
      var width=700;
      var margin=50;

      function draw(data){

        d3.select('body')
          .append('svg')
            .attr('width',width)
            .attr('height',height)
          .selectAll('circle')
          .data(data)
          .enter()
          .append('circle')

        var x_extent = d3.extent(data, function(d){return d[1]});
        var x_scale = d3.scale.linear()
                              .range([margin,width-margin])
                              .domain(x_extent);
        var y_extent = d3.extent(data, function(d){return d[0]});
        var y_scale = d3.scale.linear()
                              .range([height-margin,margin])
                              .domain(y_extent);
        d3.selectAll('circle')
                    .attr('cx', function(d){return x_scale(d[1])})
                    .attr('cy', function(d){return y_scale(d[0])})
                    .attr('r',3);

        var line = d3.svg.line()
                         .x(function(d){return x_scale(d[1])})
                         .y(function(d){return y_scale(d[0])});
        d3.select('svg')
          .append('path')
            .attr('d',line(data));
      
      
        };
      

      $.getJSON('/_aggregatesql/${statement[0]}', function(data){
        statement = data[0];

        dataHtml = '';
        dataHtml += '<tr><td>count:</td><td>'+statement[2]+'</td></tr>';
        dataHtml += '<tr><td>avg:</td><td>'+statement[3]+'</td></tr>';
        dataHtml += '<tr><td>min:</td><td>'+statement[4]+'</td></tr>';
        dataHtml += '<tr><td>max:</td><td>'+statement[5]+'</td></tr>';
        $('#data').append(dataHtml);

        //highlight sql syntax
        sh_highlightDocument();
        
        //draw graph
        draw(statement[6]);
      });



    });
  </script>
</head>
<body>

  <a href="/">Home</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/aggregatesql">Aggregated SQL</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;Statement
  <div>
    <pre class="sh_sql">${statement[1].replace(',',',\n      ').replace('AND','\n  AND')}</pre>
  </div>
  <table id="data"></table>


</body>
</html>
